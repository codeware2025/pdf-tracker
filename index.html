<!DOCTYPE html>
<html>
<head>
    <title>PDF Tracking System</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 10px; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ðŸ“„ PDF Tracking System</h1>
    <div class="container">
        <h2>Create Tracked Document</h2>
        <form id="documentForm">
            <input type="text" id="pdf_id" placeholder="Document ID (e.g., QUOTE_001)" required>
            <input type="text" id="client_name" placeholder="Client Name" required>
            <textarea id="content" placeholder="Document content..." rows="10" required></textarea>
            <button type="submit">Generate Document</button>
        </form>
    </div>
    
    <div id="result" style="display: none; margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 5px;"></div>

    <script>
        document.getElementById('documentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                pdf_id: document.getElementById('pdf_id').value,
                client_name: document.getElementById('client_name').value,
                content: document.getElementById('content').value
            };
            
            try {
                const response = await fetch('/create-document', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    const resultDiv = document.getElementById('result');
                    resultDiv.innerHTML = `
                        <h3>âœ… Document Created Successfully!</h3>
                        <p><strong>Document ID:</strong> ${result.pdf_id}</p>
                        <p><strong>Client:</strong> ${result.client_name}</p>
                        <p><strong>Tracking URL:</strong> ${result.tracking_url}</p>
                        <button onclick="downloadHTML('${result.pdf_id}', \`${result.html_content}\`)">Download HTML Document</button>
                        <hr>
                        <p><strong>How to use:</strong></p>
                        <ol>
                            <li>Download the HTML file</li>
                            <li>Send it to your client</li>
                            <li>When they open it, you'll receive notifications</li>
                            <li>Check analytics at: <a href="/analytics/${result.pdf_id}">/analytics/${result.pdf_id}</a></li>
                        </ol>
                    `;
                    resultDiv.style.display = 'block';
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Error creating document: ' + error);
            }
        });
        
        function downloadHTML(filename, content) {
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>